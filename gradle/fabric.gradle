def getFabricApiKey = { ->
    def noKey = "abcdeabcde123456789012345678901234567890"
    def key = project.hasProperty('fabricApiKey') ? fabricApiKey.toString() :
            System.getenv("FABRIC_API_KEY") ?: noKey
    if (key == noKey)
        println "Fabric API key not found in variables"
    else
        println "Fabric API key found in variables (will be set if not exist)"
    return key
}

task fabricProperties() {
    description "Generate fabric.properties file"
    ant.propertyfile(file: "$projectDir/fabric.properties") {
        entry(key: "apiKey", default: getFabricApiKey())
    }
}

preBuild.dependsOn('fabricProperties')