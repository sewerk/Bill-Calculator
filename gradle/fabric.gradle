file("fabric.properties").withReader {
    Properties props = new Properties()
    props.load(it)
    project.ext.fabric = props
}

def getFabricApiKey = { ->
    def noKey = "abcdeabcde123456789012345678901234567890"
    def key = project.ext.fabric.apiKey ?: System.getenv("FABRIC_API_KEY") ?: noKey
    if (System.getenv("CI") == "true")
        println "Fabric Api key not found in variables. Please set it in CI secret env vars" + key
    else if (key == noKey)
        println "Make sure correct Fabric Api key is set in fabric.properties"
    return key
}

task fabricProperties() {
    description "Generate fabric.properties file"
    ant.propertyfile(file: "$projectDir/fabric.properties") {
        entry(key: "apiKey", default: getFabricApiKey())
    }
}

preBuild.dependsOn('fabricProperties')